<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <title>Patrocinadores</title>
  <link rel="stylesheet" href="../style.css">
  <link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap" rel="stylesheet">
  <script defer src="../saveManager.js"></script>
  <script defer>
    /**
     * Exibe os patrocinadores disponíveis, agrupados por nível (alto, medio, baixo).
     * Cada patrocinador é carregado do arquivo data/patrocinadores.json. O jogo
     * carregado do localStorage define a equipe atual, mas por enquanto listamos
     * todos os patrocinadores disponíveis. A lógica de limitação (1 master,
     * 5 médios, 10 pequenos) pode ser implementada posteriormente.
     */
    window.onload = async () => {
      const jogo = loadGameData();
      if (!jogo) {
        alert("Nenhum jogo salvo. Voltando ao menu.");
        location.href = "../menu-principal.html";
        return;
      }

      const container = document.getElementById("lista-patrocinadores");

      let patrocinadores;
      try {
        const response = await fetch("../data/patrocinadores.json");
        patrocinadores = await response.json();
      } catch (error) {
        console.warn('Falha ao carregar patrocinadores via fetch, usando fallback.', error);
        patrocinadores = [
          { nome: 'Rothmans', bonus: 1200000, nivel: 'alto' },
          { nome: 'Mild Seven', bonus: 1100000, nivel: 'alto' },
          { nome: 'Marlboro', bonus: 1150000, nivel: 'alto' },
          { nome: 'Castrol', bonus: 600000, nivel: 'medio' },
          { nome: 'Shell', bonus: 550000, nivel: 'medio' },
          { nome: 'Sasol', bonus: 500000, nivel: 'medio' },
          { nome: 'Goodyear', bonus: 300000, nivel: 'baixo' },
          { nome: 'Canon', bonus: 350000, nivel: 'baixo' },
          { nome: 'Mobil 1', bonus: 320000, nivel: 'baixo' },
          { nome: 'Camel', bonus: 400000, nivel: 'medio' }
        ];
      }
      // Agrupa patrocinadores por nível (alto = master, medio, baixo)
      const grupos = { alto: [], medio: [], baixo: [] };
      patrocinadores.forEach(p => {
        if (p.nivel === 'alto' || p.nivel === 'medio' || p.nivel === 'baixo') {
          grupos[p.nivel].push(p);
        }
      });
      const nomesGrupo = { alto: 'Master', medio: 'Médio', baixo: 'Pequeno' };
      Object.keys(grupos).forEach(nivel => {
        if (grupos[nivel].length === 0) return;
        const header = document.createElement('h2');
        header.textContent = `Patrocínio ${nomesGrupo[nivel]}`;
        container.appendChild(header);
        grupos[nivel].forEach(p => {
          const div = document.createElement('div');
          div.className = 'patro-item';
          div.innerText = `${p.nome} - Bônus: $${p.bonus.toLocaleString()} por corrida`;
          container.appendChild(div);
        });
      });
    };
  </script>
  <style>
    body {
      background-color: black;
      color: red;
      font-family: 'Press Start 2P', monospace;
      padding: 20px;
    }
    h1 {
      font-size: 16px;
      margin-bottom: 20px;
    }
    .patro-item {
      margin-bottom: 10px;
    }
    button {
      margin-top: 20px;
      background-color: black;
      color: red;
      border: 2px solid red;
      padding: 10px 20px;
      font-family: 'Press Start 2P', monospace;
      cursor: pointer;
    }
    button:hover {
      background-color: red;
      color: black;
    }
  </style>
</head>
<body>
  <h1>Patrocinadores Disponíveis</h1>
  <div id="lista-patrocinadores"></div>
  <!--
    O botão de volta deve usar um caminho relativo para funcionar corretamente
    quando o jogo é aberto via file:// ou hospedado em qualquer pasta.  Usar
    um caminho absoluto (começando com '/') tenta navegar a partir da raiz
    do servidor, o que pode quebrar em ambientes locais.  Por isso, usamos
    '../menu-principal.html' para voltar ao menu principal.
  -->
  <button onclick="window.location.href='../menu-principal.html'">Voltar</button>
</body>
</html>