<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <title>Staff da Equipe</title>
  <link rel="stylesheet" href="../style.css">
  <link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap" rel="stylesheet">
  <script defer src="../saveManager.js"></script>
  <!-- Removido script inexistente ../dados/staff.js; agora carregamos staff via fetch ou fallback -->
  <style>
    body {
      background-color: black;
      color: white;
      font-family: 'Press Start 2P', monospace;
      padding: 20px;
    }
    h1 {
      color: red;
      font-size: 14px;
      margin-bottom: 20px;
    }
    .departamento {
      border: 2px solid red;
      padding: 10px;
      margin-bottom: 10px;
    }
    .departamento h2 {
      font-size: 12px;
      color: red;
    }
    .departamento p {
      font-size: 10px;
      margin: 4px 0;
    }
    .voltar {
      margin-top: 20px;
      background-color: black;
      color: white;
      border: 2px solid red;
      font-family: 'Press Start 2P', monospace;
      padding: 8px 16px;
      cursor: pointer;
    }
    .voltar:hover {
      background-color: red;
      color: black;
    }
  </style>
</head>
<body>
  <h1>ðŸ“‹ Staff da Equipe</h1>
  <div id="staff"></div>
  <button class="voltar" onclick="window.location.href='../menu-principal.html'">Voltar</button>

  <script>
    const pesos = {
      "Diretor TÃ©cnico": 0.20,
      "Chefe de R&D": 0.30,
      "Chefe de Equipe": 0.20,
      "Chefe de Corrida": 0.20,
      "Diretor de Marketing": 0.10
    };

    const nomesDepartamentos = {
      "Diretor TÃ©cnico": "Departamento TÃ©cnico",
      "Chefe de R&D": "Departamento de R&D",
      "Chefe de Equipe": "Departamento EstratÃ©gico de Corrida",
      "Chefe de Corrida": "Departamento de Pit-Stop",
      "Diretor de Marketing": "Departamento de Marketing"
    };

    /*
     * Lista de staff reduzida para funcionamento offline. Quando a pÃ¡gina
     * estiver rodando via HTTP, tentaremos carregar o arquivo
     * ../data/staff.json; em caso de falha, usaremos este fallback.
     */
    const STAFF_DATA_FALLBACK = [
      { nome: "Adrian Newey", cargo: "Diretor TÃ©cnico", habilidade: 60, equipeInicial: "Williams" },
      { nome: "Ross Brawn", cargo: "Diretor TÃ©cnico", habilidade: 70, equipeInicial: "Benetton" },
      { nome: "Gustav Brunner", cargo: "Diretor TÃ©cnico", habilidade: 80, equipeInicial: "Ferrari" },
      { nome: "Frank Dernie", cargo: "Diretor TÃ©cnico", habilidade: 90, equipeInicial: "McLaren" },
      { nome: "Gary Anderson", cargo: "Diretor TÃ©cnico", habilidade: 100, equipeInicial: "Jordan" },
      { nome: "Pierre WachÃ©", cargo: "Chefe de R&D", habilidade: 60, equipeInicial: "Williams" },
      { nome: "Dino Toso", cargo: "Chefe de R&D", habilidade: 70, equipeInicial: "Benetton" },
      { nome: "LoÃ¯c Bigois", cargo: "Chefe de R&D", habilidade: 80, equipeInicial: "Ferrari" },
      { nome: "Luca Baldisserri", cargo: "Chefe de R&D", habilidade: 90, equipeInicial: "McLaren" },
      { nome: "James Key", cargo: "Chefe de R&D", habilidade: 100, equipeInicial: "Jordan" },
      { nome: "Ron Dennis", cargo: "Chefe de Equipe", habilidade: 95, equipeInicial: "McLaren" },
      { nome: "Jean Todt", cargo: "Chefe de Equipe", habilidade: 95, equipeInicial: "Ferrari" },
      { nome: "Frank Williams", cargo: "Chefe de Equipe", habilidade: 95, equipeInicial: "Williams" },
      { nome: "Flavio Briatore", cargo: "Chefe de Equipe", habilidade: 92, equipeInicial: "Benetton" },
      { nome: "Tom Walkinshaw", cargo: "Chefe de Corrida", habilidade: 85, equipeInicial: "Benetton" },
      { nome: "Nigel Stepney", cargo: "Chefe de Corrida", habilidade: 80, equipeInicial: "Ferrari" },
      { nome: "Jo Ramirez", cargo: "Chefe de Corrida", habilidade: 88, equipeInicial: "McLaren" },
      { nome: "Ian Phillips", cargo: "Diretor de Marketing", habilidade: 70, equipeInicial: "Jordan" },
      { nome: "Bernie Ecclestone", cargo: "Diretor de Marketing", habilidade: 95, equipeInicial: "Benetton" },
      { nome: "Peter Sauber", cargo: "Diretor de Marketing", habilidade: 80, equipeInicial: "Sauber" }
    ];

    window.onload = async () => {
      const jogo = loadGameData();
      if (!jogo || !jogo.equipe) {
        alert("Jogo nÃ£o carregado.");
        location.href = "../index.html";
        return;
      }

      // Tenta carregar dados completos via fetch; em caso de falha, usa o fallback
      let staff;
      try {
        const res = await fetch("../data/staff.json");
        staff = await res.json();
      } catch (err) {
        console.warn("Falha ao carregar staff.json, usando dados de fallback.", err);
        staff = STAFF_DATA_FALLBACK;
      }

      const equipeStaff = staff.filter(p => p.equipeInicial === jogo.equipe);
      let totalFabrica = 0;

      const container = document.getElementById("staff");
      equipeStaff.forEach(pessoa => {
        const nivelDepartamento = pessoa.habilidade;
        const peso = pesos[pessoa.cargo] || 0.1;
        const contribuicao = (nivelDepartamento * peso).toFixed(2);
        totalFabrica += nivelDepartamento * peso;

        const div = document.createElement("div");
        div.className = "departamento";
        div.innerHTML = `
          <h2>${nomesDepartamentos[pessoa.cargo] || pessoa.cargo}</h2>
          <p><strong>ResponsÃ¡vel:</strong> ${pessoa.nome}</p>
          <p><strong>Habilidade:</strong> ${nivelDepartamento}%</p>
          <p><strong>ContribuiÃ§Ã£o para a FÃ¡brica:</strong> ${(contribuicao * 100 / peso).toFixed(1)}% de ${peso * 100}%</p>
        `;
        container.appendChild(div);
      });

      const totalDiv = document.createElement("div");
      totalDiv.style.marginTop = "20px";
      totalDiv.innerHTML = `<h2 style="color:yellow">NÃ­vel total da FÃ¡brica (via Staff): ${totalFabrica.toFixed(1)}%</h2>`;
      container.appendChild(totalDiv);
    };
  </script>
</body>
</html>
